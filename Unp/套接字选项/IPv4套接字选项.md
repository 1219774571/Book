# IPv4套接字选项

这些套接字选项由IPv4处理，它们的级别（即getsockopt和setsockopt函数的第二个参数）为**IPPROTO_IP**

## IP_HDRINCL

当本选项开启时，我们需要构造完整的IP首部，下列情况例外

> - IP总是计算并存储IP首部校验和
> - 如果我们将IP标识字段为0，内核将设置该字段
> - 如果源IP地址选项取决于实现，有些实现取出我们预先使用**IP_OPTIONS**套接字选项设置的任何IP选项，把它们添加到我们构造的首部中，而其他实现则要求我们亲自在首部指定任何期望的IP选项
> - IP首部中有些字段必须用主机字节序填写，有些字段必须用网络字节序天下，具体取决于实现

### IP_OPTIONS

本选项设置允许我们在IPv4首部中设置IP选项

#### IP_RECVDSTADDR

本套接字选项导致所收到UDP数据报的目的IP地址由**recvmsg**函数作为辅助数据返回

#### IP_RECVIF

本套接字选项导致所收到UDP数据报的接收接口索引由**recvmsg**函数作为辅助数据返回

#### IP_TOS

本套接字选项允许我们为TCP、UDP或SCTP套接字设置IP首部中的服务类型字段（该字段包含DSCP和ECN子字段）。如果我们给本选项调用getsockopt，那么用于放入外出IP数据报首部的DSCP和ECN字段中的TOS当前值（默认为0）将返回。我们没有办法从接收的IP数据报中取得该值

#### IP_TTL

我们可以使用本选项设置或获取系统用在从某个给定套接字发送的单播分组上的默认TTL值。跟TOS字段一样，调用getsockopt返回的是系统将用于外出数据报的字段的默认值。我们没有办法从接收到的IP数据报中取得该值