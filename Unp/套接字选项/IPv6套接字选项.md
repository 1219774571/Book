# IPv6套接字选项

这些套接字选项由ipv6处理，它们的级别（即getsockopt和setsockopt函数的第二个参数）为**IPPROTO_IPV6**

## IPV6_CHECKSUM

本选项指定用户数据中校验和所处位置的字节偏移。

> 为负值，那么内核将
>
> 1. 给所有外出分组计算并存储校验和
> 2. 验证外来分组的校验和，丢弃所有校验和无效的分组。
>
> 本选项影响除ICMPv6原始套接字意外的所有IPv6原始套接字

如果指定值为-1（默认值），那么内核不会在相应的原始套接字上计算并存储外出分组的校验和，也不会验证外来分组的校验和

### IPV6_DONTFRAG

开启本选项将禁止为UDP套接字或原始套接字自动插入分片首部，外出分组中大小超过发送接口MTU的分谢分组将被丢弃。发送分组的系统调用不会为此返回错误，因为已发送出去仍在途中的分组也可能因为超过路径MTU而被丢弃

#### IPV6_NEXTHOP

本选项将外出数据报的下一跳地址指定为一个套接字地址结构

#### IPV6_PATHMTU

本选项不能设置，只能获取。获取本选项时，返回值为由路径MTU发现功能确定的当前MTU

#### IPV6_RECVDSTOPTS

开启本选项表明，任何接收到的IPv6目的地选项都将由recvmsg作为辅助数据返回，默认关闭

#### IPV6_RECVHOPLIMIT

开启本选项表明，任何接收到的跳限字段都将由recvmsg作为辅助数据返回，默认关闭

#### IPV6_RECVHOPOPTS

开启本选项表明，任何接收到IPv6步跳选项都将由recvmsg作为辅助数据返回，默认关闭

#### IPV6_RECVPATHMTU

开启本选项表明，某条路径的路径MTU在发生变化时将由recvmsg作为辅助数据返回（不伴随任何数据）

#### IPV6_RECVPKTINFO

开启本选项表明，接收到的IPv6数据报的一下两条信息将由recvmsg作为辅助数据返回；目的IPv6地址和到达接口索引

#### IPV6_RECVRTHDR

开启本选项表明，接收到的IPv6路由首部将由recvmsg作为辅助数据返回，默认关闭

#### IPV6_RECVTCLASS

开启本选项表明，接收到的流通类型（包括DSCP和ECN字段）将由recvmsg作为辅助数据返回，默认关闭

#### IPV6_UNICAST_HOPS

本IPv6选项类似IPv4的IP_TTL套接字选项。设置本选项会给相应套接字上发送的外出数据报指定默认跳限，获取本选项会返回内核用于相应套接字的跳限值。来自接收到的IPv6数据报中跳限字段的实际值通过使用IPV6_RECVHOPLIMIT套接字选项取得

#### IPV6_USE_MIN_MTU

把本选项设置为1表明，路径MTU发现功能不必执行，为避免分片，分组就使用IPv6的最小MTU发送

把本选项设置为0表明，路径MTU发现功能对于所有目的地都得执行

把本选项设置为-1表明，路径MTU发现功能仅对单播目的地执行，对于多播目的地就使用最小MTU，默认-1

#### IPV6_V60NLY

在一个**AF_INET6**套接字上开启本选项将限制它只执行IPv6通信，默认关闭

#### IPV6_XXX

大多数用于修改协议首部的IPv6选项假设：

> 就UDP套接字而言，信息由**recvmsg**和**sendmsg**作为辅助数据在内核和应用程序之间传递
>
> 就TCP套接字而言，同样的信息改用**getsockopt**和**setsockopt**获取和设置。套接字选项和辅助数据的类型一致，并且访问套接字选项的缓冲区所含的信息和辅助数据中存放的信息也一致