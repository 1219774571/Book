## UDP的connect函数

---

UDP套接字调用connect：没有三路握手。内核只是检查是否存在立即可知的错误，记录对端的IP地址和端口号（取自传递给connect的套接字地址结构），然后立即返回到调用进程

我们可以区分

> - 未连接UDP套接字，新创建UDP套接字默认如此
> - 已连接UDP套接字，对UDP套接字调用connect的结果

对于已连接UDP套接字，与默认的未连接UDP套接字相比，发生了三个变化

> 1. 我们再也不能给输出操作指定目的IP地址和端口号。也就是说，我们不使用sendto，而改用write或send。写到已连接UDP套接字上的任何内容都自动发送到由connect指定的协议地址（如IP地址和端口号）
> 2. 我们不必使用recvfrom以获悉数据报的发送者，而改用read、recv或recvmsg。在一个已连接UDP套接字上，由内核为输入操作返回的数据报只是那些来自connect所指定协议地址的数据报
> 3. 由已连接UDP套接字引发的异步错误会返回给它们所在的进程，而未连接UDP套接字不接收任何异步错误

#### TCP和UDP套接字：可指定目的地协议地址吗？

|    套接字类型     | write或send  | 不指定目的地址的sendto | 指定目的地址的sendto |
| :---------------: | :----------: | :--------------------: | :------------------: |
|     TCP套接字     |     可以     |          可以          |       EISCONN        |
| UDP套接字，已连接 |     可以     |          可以          |       EISCONN        |
| UDP套接字，未连接 | EDESTADDRREQ |      EDESTADDRREQ      |         可以         |

POSIX规范指出，在未连接UDP套接字上不指定目的地址的输出操作应该返回ENOTCONN，而不是EDESTADDRREQ

